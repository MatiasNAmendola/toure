{"body":"# Set Up\r\n\r\nFirst of all you need to just move the \"toure\" folder into the base of\r\nyour app.\r\n\r\nIn order to get everything set up correctly we must first define our\r\nconstants in the conf.php file:\r\n\r\n    define('DB_HOST', ''); // your database host\r\n    define('DB_NAME', ''); // your database name\r\n    define('DB_USER', ''); // your database username\r\n    define('DB_PASS', ''); // your database password\r\n\r\nThere are also three additional settings:\r\n\r\n### Default Users Table\r\n\r\n    define('DEFAULT_USERS_TABLE', 'users');\r\n\r\nthe above defines the default table that holds your users when dealing\r\nwith a user, password type situation it is 'users' by default.\r\n\r\n### Timestamps\r\n\r\n    define('TIMESTAMPS', true); \r\n\r\nif your tables follow a timestamp pattern ( they have created_at and\r\nupdated_at in every table) then setting this to true will automagically\r\ndeal with timestamps for you.\r\n\r\nIf you require timestamps on only select tables then set to false and\r\nspecify the columns explicitly during execution.\r\n\r\n### Secure\r\n\r\n    define('SECURE', true);\r\n\r\nif you would like to make use of the libraries encryption system then\r\nset this to true, whenever you insert into a column named password it\r\nwill automatically run Secure::make() and encrypt your password. If you\r\nare using this make sure that whenever you check your password you use\r\nSecure::check(); \r\n\r\n### Include\r\n\r\nBefore use use any of the libraries in our code we must first include\r\nthe libraries.\r\n\r\nThis is simple, in every file of code you want to use the library insert\r\nthe following at the top of your page:\r\n\r\n    include('toure/autoload');\r\n\r\nAll the classes will be autoloaded as and when they are needed.\r\n\r\n\r\n# Database Usage\r\n\r\nWe can create an instance ready for queries using the following:\r\n\r\n    $dbh = Database::make();\r\n\r\nNow we have access to everything via $dbh, the first thing that should\r\nbe done is the setting of our current table we plan use:\r\n\r\n    $dbh->table('posts');\r\n\r\nonce the table id set we can start to run our query methods inline:\r\n\r\n## Selecting\r\n\r\nSelecting can be done using the following:\r\n\r\n    $dbh->table('posts')->select('title', 'content')->row();\r\n\r\nThe second method `select();` allows us to specify columns to fetch, if\r\nthis is left blank it will select all. The second column specifies\r\nwhether to return the first `row();` or `all();` of the rows either the `row();`\r\nor `all();` method must be included to run the query. Toure will return an\r\nassoc array by default but we can specify it to return different data: \r\n\r\n    $dbh->table('posts')->select()->all('assoc');\r\n    $dbh->table('posts')->select()->all('num');\r\n    $dbh->table('posts')->select()->all('obj'); \r\n\r\nTo further our query we could use any of the conditional methods which\r\ncan be added one after another for easy readable usage:\r\n\r\n* `where();`\r\n* `where_email();`\r\n* `or_();`\r\n* `and_();`\r\n\r\nWhich can be used like so:\r\n\r\n    $dbh->table('posts')\r\n        ->select('title')\r\n        ->where('id', '=', '3')\r\n        ->or_('title', '=', 'something')\r\n        ->all();\r\n\r\nSo we can mix and match different conditionals for different results,\r\nthe `where();`, `or_();` and `and_();` methods take three params, the first being\r\nthe column the second being the condition and the last is the value.\r\n\r\nYour can also use the `order_by():` method to order your results like so:\r\n\r\n    $dbh->table('posts')->select()->order_by('created_at', 'DESC')->all();\r\n\r\nWe can specify the column to sort on in the first argument and then the direction we want to sort using 'DESC' for descending and 'ASC' for ascending.\r\n\r\nCheck out the class files for more documentation all methods are\r\ndocumented.\r\n\r\n## Inserting\r\n\r\nInserting is made extremely easy by toure, we can use the `insert();` method:\r\n\r\n    $dbh->table('posts')->insert();\r\n\r\nThe insert method takes an array like so:\r\n\r\n    $input = array(\r\n               'title' => 'This is our title',\r\n               'content' => 'This is our content'\r\n             );\r\n\r\n    $dbh->table('posts')->insert($input)->save();\r\n\r\nOur insert method will automagically insert the values into the columns\r\nspecified where the array key is the column and the array value is the\r\ninput value.\r\n\r\nIt is important to note here that when inserting or updating it is\r\nrequired to use `save();` or your insert or update will not be executed.\r\n\r\n## Updating\r\n\r\nUpdating is done in exactly the same way as inserting, i.e using an\r\narray but we just specify the column that needs to be updated like so: \r\n\r\n     $input = array(\r\n                'content' => 'This is our content'\r\n              );\r\n \r\n     $dbh->table('posts')->update($input)->save();\r\n\r\nThe difference with update though is that we will often require\r\ncondition otherwise if you where to execute the code above you would\r\nchange every row in the table so we can use the same conditionals as we\r\ndid in the select section.\r\n\r\n    $dbh->table('posts')->update($input)->where('id', '=', '3')->save();\r\n\r\n## Deleting \r\n\r\nDeleting can be dangerous so we have a few different methods available\r\nto us here. \r\n\r\n* `delete();`\r\n* `delete_id($id);`\r\n* `delete_all_where();`\r\n\r\nThe `delete();` method can be used just like the other CRUD operations\r\nusing the conditional methods but is allways limited to just 1 row for\r\nsafety. \r\n\r\nThe `delete_id();` method allows us to specify an id for deletion this\r\nagain is limited to just one row.\r\n\r\nThe `delete_all_where();` method allows us to delete multiple rows that\r\nmeet the condition.\r\n\r\n## Joins\r\n\r\nA database join can also be performed using `join();` The join method \r\ncan be used along with a `select();` method like so:\r\n\r\n    $dbh->table('users')\r\n        ->select('users.email', 'posts.title')\r\n        ->join('users', 'users.id = posts.user_id')\r\n        ->all();\r\n\r\nSo in the table above you can see we can specify the join with two arguments, the first is the table to join and the second is the ON rule. If you require more fine control over your join statements then use the `query();` method that allows you to insert a raw query safely.\r\n\r\n\r\n# Validation Usage\r\n\r\n## Initializing\r\n\r\nValidation is an essential part of most applications that deal with a database interaction, we need to make sure that user submitted data is clean before we run it through our system and into the database. \r\n\r\nThis would usually have to be done in a long drawn out way that we are all to familiar with, but don't worry! Toure offers a nice and easy solution.\r\n\r\nWe start a validation test as follows:\r\n\r\n    $v = Validation::make($input, $rules, $messages);\r\n\r\nThis will initialize our validation and store it in the $v variable. Our validator takes three arguments. The first $input is an array of input from the user for example:\r\n\r\n    $input = array(\r\n                'email' => $_POST['email'],             \r\n                'password' => $_POST['password'],\r\n                'passwordconf' => '$_POST['passwordconf']\r\n             );\r\n\r\nThe next argument are our rules which are explained in the Rules section:\r\n\r\n    $rules = array(\r\n               'email' => 'required|valid_email',\r\n               'password' => 'required|min:6',\r\n               'passwordconf' => 'same:password'\r\n             );\r\n\r\nand the final optional argument is our custom error messages, if the messages are not included then default error messages will be include.\r\n\r\n## Rules\r\n\r\nWe have the following rules to choose from:\r\n\r\n* required - Specifies input is required\r\n* string - Checks if input is string\r\n* numeric - Checks if input is numeric\r\n* int - Checks if input is integer\r\n* unique:? - Queries database using default users table from config, column can be specified like unique:username default column is email\r\n* same:? - Checks that input is the same as specified param eg. same:password\r\n* min:? - Checks if a minimum amount of characters has been entered eg. min:6\r\n* max:? - Checks if a maximum amount of characters has been entered eg. max:10\r\n* in:? - Checks for a value in an array eg. in:products\r\n* valid_email - Checks if email is valid\r\n* valid_url - Checks if URL is valid\r\n\r\nrules should be included as the second argument as an array with the keys corresponding to the same keys in the input array for the first argument. Multiple rules can be included as long as you separate each rule using a pipe '|' :\r\n\r\n    $rules = array(\r\n               'email' => 'required|valid_email',\r\n               'password' => 'required|min:6',\r\n               'passwordconf' => 'same:password'\r\n             );\r\n\r\n## Running The Validation\r\n\r\nTo check whether the input has validated we can use two methods that return Boolean results:\r\n\r\n    $v->passed();\r\n\r\nThe above checks if there where no errors and return true if everything passed and false if not. If needed you can check the opposite using:\r\n\r\n    $v->failed();\r\n\r\nWe can then retrieve all our errors using the following:\r\n\r\n    $v->get_errors();\r\n\r\nThis will return and associative array including any errors that where returned to us from the validation if nothing went wrong this will be empty. We can retrieve errors specific to an input if we like using:\r\n\r\n    $v->errors('email');\r\n\r\nThe above will only return the errors from the email input field.\r\n\r\n## Custom Error Messages\r\n\r\nThe validation class will automatically return error messages but if you would like to use your own and it is recommended that you do, you can include a third argument to the `Validation::make();` method, an array of message where the key is the field and rule your error message applies to separated by an underscore like so:\r\n\r\n    $messages = array(\r\n                  'email_required' => 'Email is required!', \r\n                  'email_valid_email' => 'Please enter a valid email address!',\r\n                  'passwordconf_same' => 'Passwords do not match!'\r\n                );\r\n \r\nThe above will then map the error messages to the right rules and input fields so that when you use `$v->get_errors();` your messages will be returned instead.\r\n\r\n## Validation Example\r\n\r\nPutting all the above together can be quite confusing at first so let's go through a real world example to show you how useful the validation library is.\r\n\r\nLet's say we have someone who will be entering information to create a new user through a form using the POST method. First lets catch all the data and assign it to variables:\r\n\r\n    $email = $_POST['email'];\r\n    $password = $_POST['password'];\r\n    $passwordconf = $_POST['passwordconf'];\r\n\r\nNext we need to fire up our validation and pass in three arguments that consist of the input, rules and custom error messages:\r\n\r\n    $input = array(\r\n               'email' => $email,\r\n               'password' => $password,\r\n               'passwordconf' => $passwordconf\r\n             );\r\n\r\n    $rules = array(\r\n               'email' => 'required|valid_email',\r\n               'password' => 'required|min:6',\r\n               'passwordconf' => 'required|same:password'\r\n             );\r\n\r\n    $messages = array(\r\n               'email_required' => \"Email is required\",\r\n               'email_valid_email' => 'Email is not valid',\r\n               'passwordconf_same' => 'Passwords do not match' \r\n             );\r\n\r\n    $v = Validation::make($input, $rules, $messages);\r\n\r\n    if ($v->passed()){\r\n        echo \"passed!\";\r\n    } else {\r\n        $errors = $v->get_errors();\r\n    }\r\n\r\n\r\nThe code above will now run our validation and if it passes will show us a message saying \"passed\" or will set our errors to a variable called errors which we can manipulate further if we like.\r\n\r\n \r\n\r\n\r\n\r\n\r\n\r\n\r\n","note":"Don't delete this file! It's used internally to help with page regeneration.","name":"Toure","tagline":"A simple MySQL abstraction and input validation library.","google":""}