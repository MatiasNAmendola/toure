<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Toure by ryankennedy1991</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Toure</h1>
        <p>A simple MySQL abstraction and input validation library.</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/ryankennedy1991/toure" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/ryankennedy1991/toure/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/ryankennedy1991/toure/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>Set Up</h1>

<p>First of all you need to just move the "toure" folder into the base of
your app.</p>

<p>In order to get everything set up correctly we must first define our
constants in the conf.php file:</p>

<pre><code>define('DB_HOST', ''); // your database host
define('DB_NAME', ''); // your database name
define('DB_USER', ''); // your database username
define('DB_PASS', ''); // your database password
</code></pre>

<p>There are also three additional settings:</p>

<h3>Default Users Table</h3>

<pre><code>define('DEFAULT_USERS_TABLE', 'users');
</code></pre>

<p>the above defines the default table that holds your users when dealing
with a user, password type situation it is 'users' by default.</p>

<h3>Timestamps</h3>

<pre><code>define('TIMESTAMPS', true); 
</code></pre>

<p>if your tables follow a timestamp pattern ( they have created_at and
updated_at in every table) then setting this to true will automagically
deal with timestamps for you.</p>

<p>If you require timestamps on only select tables then set to false and
specify the columns explicitly during execution.</p>

<h3>Secure</h3>

<pre><code>define('SECURE', true);
</code></pre>

<p>if you would like to make use of the libraries encryption system then
set this to true, whenever you insert into a column named password it
will automatically run Secure::make() and encrypt your password. If you
are using this make sure that whenever you check your password you use
Secure::check(); </p>

<h3>Include</h3>

<p>Before use use any of the libraries in our code we must first include
the libraries.</p>

<p>This is simple, in every file of code you want to use the library insert
the following at the top of your page:</p>

<pre><code>include('toure/autoload');
</code></pre>

<p>All the classes will be autoloaded as and when they are needed.</p>

<h1>Database Usage</h1>

<p>We can create an instance ready for queries using the following:</p>

<pre><code>$dbh = Database::make();
</code></pre>

<p>Now we have access to everything via $dbh, the first thing that should
be done is the setting of our current table we plan use:</p>

<pre><code>$dbh-&gt;table('posts');
</code></pre>

<p>once the table id set we can start to run our query methods inline:</p>

<h2>Selecting</h2>

<p>Selecting can be done using the following:</p>

<pre><code>$dbh-&gt;table('posts')-&gt;select('title', 'content')-&gt;row();
</code></pre>

<p>The second method <code>select();</code> allows us to specify columns to fetch, if
this is left blank it will select all. The second column specifies
whether to return the first <code>row();</code> or <code>all();</code> of the rows either the <code>row();</code>
or <code>all();</code> method must be included to run the query. Toure will return an
assoc array by default but we can specify it to return different data: </p>

<pre><code>$dbh-&gt;table('posts')-&gt;select()-&gt;all('assoc');
$dbh-&gt;table('posts')-&gt;select()-&gt;all('num');
$dbh-&gt;table('posts')-&gt;select()-&gt;all('obj'); 
</code></pre>

<p>To further our query we could use any of the conditional methods which
can be added one after another for easy readable usage:</p>

<ul>
<li><code>where();</code></li>
<li><code>where_email();</code></li>
<li><code>or_();</code></li>
<li><code>and_();</code></li>
</ul><p>Which can be used like so:</p>

<pre><code>$dbh-&gt;table('posts')
    -&gt;select('title')
    -&gt;where('id', '=', '3')
    -&gt;or_('title', '=', 'something')
    -&gt;all();
</code></pre>

<p>So we can mix and match different conditionals for different results,
the <code>where();</code>, <code>or_();</code> and <code>and_();</code> methods take three params, the first being
the column the second being the condition and the last is the value.</p>

<p>Your can also use the <code>order_by():</code> method to order your results like so:</p>

<pre><code>$dbh-&gt;table('posts')-&gt;select()-&gt;order_by('created_at', 'DESC')-&gt;all();
</code></pre>

<p>We can specify the column to sort on in the first argument and then the direction we want to sort using 'DESC' for descending and 'ASC' for ascending.</p>

<p>Check out the class files for more documentation all methods are
documented.</p>

<h2>Inserting</h2>

<p>Inserting is made extremely easy by toure, we can use the <code>insert();</code> method:</p>

<pre><code>$dbh-&gt;table('posts')-&gt;insert();
</code></pre>

<p>The insert method takes an array like so:</p>

<pre><code>$input = array(
           'title' =&gt; 'This is our title',
           'content' =&gt; 'This is our content'
         );

$dbh-&gt;table('posts')-&gt;insert($input)-&gt;save();
</code></pre>

<p>Our insert method will automagically insert the values into the columns
specified where the array key is the column and the array value is the
input value.</p>

<p>It is important to note here that when inserting or updating it is
required to use <code>save();</code> or your insert or update will not be executed.</p>

<h2>Updating</h2>

<p>Updating is done in exactly the same way as inserting, i.e using an
array but we just specify the column that needs to be updated like so: </p>

<pre><code> $input = array(
            'content' =&gt; 'This is our content'
          );

 $dbh-&gt;table('posts')-&gt;update($input)-&gt;save();
</code></pre>

<p>The difference with update though is that we will often require
condition otherwise if you where to execute the code above you would
change every row in the table so we can use the same conditionals as we
did in the select section.</p>

<pre><code>$dbh-&gt;table('posts')-&gt;update($input)-&gt;where('id', '=', '3')-&gt;save();
</code></pre>

<h2>Deleting</h2>

<p>Deleting can be dangerous so we have a few different methods available
to us here. </p>

<ul>
<li><code>delete();</code></li>
<li><code>delete_id($id);</code></li>
<li><code>delete_all_where();</code></li>
</ul><p>The <code>delete();</code> method can be used just like the other CRUD operations
using the conditional methods but is allways limited to just 1 row for
safety. </p>

<p>The <code>delete_id();</code> method allows us to specify an id for deletion this
again is limited to just one row.</p>

<p>The <code>delete_all_where();</code> method allows us to delete multiple rows that
meet the condition.</p>

<h2>Joins</h2>

<p>A database join can also be performed using <code>join();</code> The join method 
can be used along with a <code>select();</code> method like so:</p>

<pre><code>$dbh-&gt;table('users')
    -&gt;select('users.email', 'posts.title')
    -&gt;join('users', 'users.id = posts.user_id')
    -&gt;all();
</code></pre>

<p>So in the table above you can see we can specify the join with two arguments, the first is the table to join and the second is the ON rule. If you require more fine control over your join statements then use the <code>query();</code> method that allows you to insert a raw query safely.</p>

<h1>Validation Usage</h1>

<h2>Initializing</h2>

<p>Validation is an essential part of most applications that deal with a database interaction, we need to make sure that user submitted data is clean before we run it through our system and into the database. </p>

<p>This would usually have to be done in a long drawn out way that we are all to familiar with, but don't worry! Toure offers a nice and easy solution.</p>

<p>We start a validation test as follows:</p>

<pre><code>$v = Validation::make($input, $rules, $messages);
</code></pre>

<p>This will initialize our validation and store it in the $v variable. Our validator takes three arguments. The first $input is an array of input from the user for example:</p>

<pre><code>$input = array(
            'email' =&gt; $_POST['email'],             
            'password' =&gt; $_POST['password'],
            'passwordconf' =&gt; '$_POST['passwordconf']
         );
</code></pre>

<p>The next argument are our rules which are explained in the Rules section:</p>

<pre><code>$rules = array(
           'email' =&gt; 'required|valid_email',
           'password' =&gt; 'required|min:6',
           'passwordconf' =&gt; 'same:password'
         );
</code></pre>

<p>and the final optional argument is our custom error messages, if the messages are not included then default error messages will be include.</p>

<h2>Rules</h2>

<p>We have the following rules to choose from:</p>

<ul>
<li>required - Specifies input is required</li>
<li>string - Checks if input is string</li>
<li>numeric - Checks if input is numeric</li>
<li>int - Checks if input is integer</li>
<li>unique:? - Queries database using default users table from config, column can be specified like unique:username default column is email</li>
<li>same:? - Checks that input is the same as specified param eg. same:password</li>
<li>min:? - Checks if a minimum amount of characters has been entered eg. min:6</li>
<li>max:? - Checks if a maximum amount of characters has been entered eg. max:10</li>
<li>in:? - Checks for a value in an array eg. in:products</li>
<li>valid_email - Checks if email is valid</li>
<li>valid_url - Checks if URL is valid</li>
</ul><p>rules should be included as the second argument as an array with the keys corresponding to the same keys in the input array for the first argument. Multiple rules can be included as long as you separate each rule using a pipe '|' :</p>

<pre><code>$rules = array(
           'email' =&gt; 'required|valid_email',
           'password' =&gt; 'required|min:6',
           'passwordconf' =&gt; 'same:password'
         );
</code></pre>

<h2>Running The Validation</h2>

<p>To check whether the input has validated we can use two methods that return Boolean results:</p>

<pre><code>$v-&gt;passed();
</code></pre>

<p>The above checks if there where no errors and return true if everything passed and false if not. If needed you can check the opposite using:</p>

<pre><code>$v-&gt;failed();
</code></pre>

<p>We can then retrieve all our errors using the following:</p>

<pre><code>$v-&gt;get_errors();
</code></pre>

<p>This will return and associative array including any errors that where returned to us from the validation if nothing went wrong this will be empty. We can retrieve errors specific to an input if we like using:</p>

<pre><code>$v-&gt;errors('email');
</code></pre>

<p>The above will only return the errors from the email input field.</p>

<h2>Custom Error Messages</h2>

<p>The validation class will automatically return error messages but if you would like to use your own and it is recommended that you do, you can include a third argument to the <code>Validation::make();</code> method, an array of message where the key is the field and rule your error message applies to separated by an underscore like so:</p>

<pre><code>$messages = array(
              'email_required' =&gt; 'Email is required!', 
              'email_valid_email' =&gt; 'Please enter a valid email address!',
              'passwordconf_same' =&gt; 'Passwords do not match!'
            );
</code></pre>

<p>The above will then map the error messages to the right rules and input fields so that when you use <code>$v-&gt;get_errors();</code> your messages will be returned instead.</p>

<h2>Validation Example</h2>

<p>Putting all the above together can be quite confusing at first so let's go through a real world example to show you how useful the validation library is.</p>

<p>Let's say we have someone who will be entering information to create a new user through a form using the POST method. First lets catch all the data and assign it to variables:</p>

<pre><code>$email = $_POST['email'];
$password = $_POST['password'];
$passwordconf = $_POST['passwordconf'];
</code></pre>

<p>Next we need to fire up our validation and pass in three arguments that consist of the input, rules and custom error messages:</p>

<pre><code>$input = array(
           'email' =&gt; $email,
           'password' =&gt; $password,
           'passwordconf' =&gt; $passwordconf
         );

$rules = array(
           'email' =&gt; 'required|valid_email',
           'password' =&gt; 'required|min:6',
           'passwordconf' =&gt; 'required|same:password'
         );

$messages = array(
           'email_required' =&gt; "Email is required",
           'email_valid_email' =&gt; 'Email is not valid',
           'passwordconf_same' =&gt; 'Passwords do not match' 
         );

$v = Validation::make($input, $rules, $messages);

if ($v-&gt;passed()){
    echo "passed!";
} else {
    $errors = $v-&gt;get_errors();
}
</code></pre>

<p>The code above will now run our validation and if it passes will show us a message saying "passed" or will set our errors to a variable called errors which we can manipulate further if we like.</p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/ryankennedy1991">ryankennedy1991</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>